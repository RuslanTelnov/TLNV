# Ошибки Парсинга Wildberries

В этом документе описаны распространенные проблемы, возникающие при парсинге Wildberries, и способы их решения.

## 1. Отсутствуют изображения товаров (WB)

**Симптомы:**
- В базе данных поле `image_url` пустое или ведет на `basket-XX` (старый домен), который не открывается.
- На сайте вместо фото заглушка.

**Причина:**
Wildberries периодически меняет структуру CDN и добавляет новые сервера ("корзины").
- Ранее использовались корзины `basket-01` ... `basket-20`.
- Новые товары теперь размещаются на `basket-21`, `basket-22` и вплоть до `basket-40` (по состоянию на 2026 год).
- Если парсер проверяет только первые 20, он не находит изображения для новых товаров.

**Решение:**
В файле `moysklad-automation/parse_wb_top.py` необходимо:
1. Расширить диапазон перебора хостов.
2. Использовать актуальные пути к изображениям.

```python
# ПРАВИЛЬНО:
for i in range(1, 41): # Проверяем до 40
    host = f"basket-{i:02d}.wbbasket.ru"

# Формирование ссылки (лучше использовать big/1.webp для качества):
img_url = f"https://{host}/vol{vol}/part{part}/{nm_id}/images/big/1.webp"
```

## 2. Ошибка "ModuleNotFoundError: No module named 'selenium'"

**Симптомы:**
- При запуске скрипта через `python parse_wb.py` или из Node.js падает ошибка импорта.

**Причина:**
- Скрипт запускается системным Python, в котором не установлены библиотеки.
- Или используется неправильное виртуальное окружение.

**Решение:**
Всегда указывайте полный путь к интерпретатору или используйте корректную команду (например, `python3.11`, если пакеты установлены там).
При вызове из Node.js (`execFile`) убедитесь, что путь к python ведет в `.venv/bin/python`.

## 3. Selenium не находит элементы (CSS Selectors)

**Симптомы:**
- Ошибки `NoSuchElementException`.
- Парсер возвращает пустые данные или "Unknown".

**Причина:**
- Wildberries часто меняет классы на сайте (защита от парсинга).
- Контент подгружается динамически (Infinite Scroll), и элементы еще не появились в DOM.

**Решение:**
- Использовать `try-except` блоки для каждого поля.
- Добавлять скролл страницы перед парсингом:
```python
for _ in range(10):
    driver.execute_script("window.scrollBy(0, 1000);")
    time.sleep(0.5)
```
- Регулярно обновлять CSS селекторы, проверяя их через DevTools браузера.
